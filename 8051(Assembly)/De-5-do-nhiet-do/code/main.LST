A51 MACRO ASSEMBLER  MAIN                                                                 05/03/2025 17:10:16 PAGE     1


MACRO ASSEMBLER A51 V8.2.7.0
OBJECT MODULE PLACED IN main.OBJ
ASSEMBLER INVOKED BY: C:\Keil_v5\C51\BIN\A51.EXE main.asm SET(SMALL) DEBUG EP

LOC  OBJ            LINE     SOURCE

                       1     $mod51 
                       2     ; Ch·ªâ ƒë·ªãnh s·ª≠ d·ª•ng b·ªô vi ƒëi·ªÅu khi·ªÉn 8051.
                       3     
0000                   4     ORG 0000H
                       5     ; ƒê·∫∑t ƒë·ªãa ch·ªâ b·∫Øt ƒë·∫ßu c·ªßa ch∆∞∆°ng tr√¨nh t·∫°i 0x0000.
                       6     
                       7     ; ===== ƒê·ªãnh nghƒ©a =====
  0031                 8     TEMP_LM  EQU 31H       ; ƒê·ªãa ch·ªâ b·ªô nh·ªõ l∆∞u gi√° tr·ªã nhi·ªát ƒë·ªô sau khi ƒë√£
                              nh√¢n ƒë√¥i.
  00B2                 9     RD_PIN   EQU P3.2      ; Ch√¢n ƒëi·ªÅu khi·ªÉn ƒë·ªçc d·ªØ li·ªáu (Read) c·ªßa chip ADC0804.
  00B3                10     WR_PIN   EQU P3.3      ; Ch√¢n ƒëi·ªÅu khi·ªÉn ghi d·ªØ li·ªáu (Write) / b·∫Øt ƒë·∫ßu chuy·
                             ªÉn ƒë·ªïi c·ªßa chip ADC0804.
  00B4                11     INTR     EQU P3.4      ; Ch√¢n b√°o ng·∫Øt (Interrupt) c·ªßa chip ADC0804, b√°o hi·ªáu qu√°
                              tr√¨nh chuy·ªÉn ƒë·ªïi ho√†n t·∫•t.
                      12     
                      13     ; ===== Ch∆∞∆°ng tr√¨nh ch√≠nh =====
0000                  14     START:
0000 75A000           15         MOV P2, #00H       ; Thi·∫øt l·∫≠p gi√° tr·ªã ban ƒë·∫ßu cho Port 2 l√† 00H, t·∫Øt t·∫•
                             t c·∫£ c√°c ƒëo·∫°n c·ªßa LED 7 ƒëo·∫°n (v·ªõi LED cathode chung, m·ª©c 0 t√≠ch c·ª±c).
0003 7580FF           16         MOV P0, #0FFH      ; Thi·∫øt l·∫≠p gi√° tr·ªã ban ƒë·∫ßu cho Port 0 l√† 0FFH, t·∫Øt t·∫
                             •t c·∫£ c√°c LED (v·ªõi LED ƒë∆∞·ª£c ch·ªçn b·∫±ng m·ª©c th·∫•p, m·ª©c 1 kh√¥ng ch·ªçn).
                      17     
0006                  18     MAIN_LOOP:
0006 1110             19         ACALL read_adc         ; G·ªçi ch∆∞∆°ng tr√¨nh con (Subroutine Call) ƒë·ªÉ ƒë·ªçc gi√° 
                             tr·ªã t·ª´ ADC0804.
0008 1124             20         ACALL adc_to_temp      ; G·ªçi ch∆∞∆°ng tr√¨nh con ƒë·ªÉ chuy·ªÉn ƒë·ªïi gi√° tr·ªã ADC
                              sang gi√° tr·ªã nhi·ªát ƒë·ªô (ƒë√£ nh√¢n ƒë√¥i).
000A 112A             21         ACALL extract_digits   ; G·ªçi ch∆∞∆°ng tr√¨nh con ƒë·ªÉ t√°ch gi√° tr·ªã nhi·ªát ƒë·ªô
                              th√†nh c√°c ch·ªØ s·ªë h√†ng trƒÉm, ch·ª•c, ƒë∆°n v·ªã.
000C 113B             22         ACALL display_numbers  ; G·ªçi ch∆∞∆°ng tr√¨nh con ƒë·ªÉ hi·ªÉn th·ªã c√°c ch·ªØ s·ªë l
                             √™n 4 LED 7 ƒëo·∫°n.
000E 80F6             23         SJMP MAIN_LOOP         ; Nh·∫£y kh√¥ng ƒëi·ªÅu ki·ªán (Short Jump) v·ªÅ ƒë·∫ßu v√≤ng l·
                             ∫∑p ch√≠nh ƒë·ªÉ th·ª±c hi·ªán l·∫°i c√°c b∆∞·ªõc.
                      24     
                      25     ;-------------------------------------------------
                      26     ; ƒê·ªçc d·ªØ li·ªáu t·ª´ ADC0804
                      27     ;-------------------------------------------------
0010                  28     read_adc:
0010 C2B3             29         CLR WR_PIN             ; X√≥a bit (Clear bit) c·ªßa ch√¢n WR_PIN xu·ªëng m·ª©c th·∫•p, 
                             b·∫Øt ƒë·∫ßu qu√° tr√¨nh chuy·ªÉn ƒë·ªïi ADC.
0012 1168             30         ACALL delay            ; G·ªçi ch∆∞∆°ng tr√¨nh con delay ƒë·ªÉ t·∫°o kho·∫£ng th·ªùi gi
                             an c·∫ßn thi·∫øt cho qu√° tr√¨nh b·∫Øt ƒë·∫ßu chuy·ªÉn ƒë·ªïi.
0014 D2B3             31         SETB WR_PIN            ; ƒê·∫∑t bit (Set bit) c·ªßa ch√¢n WR_PIN l√™n m·ª©c cao, k·∫øt 
                             th√∫c xung k√≠ch ho·∫°t chuy·ªÉn ƒë·ªïi.
                      32     
0016                  33     wait_intr:
0016 20B4FD           34         JB INTR, wait_intr     ; Nh·∫£y n·∫øu bit (Jump if Bit) INTR b·∫±ng 1 v·ªÅ l·∫°i ch√≠nh
                              n√≥, ƒë·ª£i cho ch√¢n INTR xu·ªëng m·ª©c 0 (b√°o hi·ªáu chuy·ªÉn ƒë·ªïi ho√†n t·∫•t).
0019 C2B2             35         CLR RD_PIN             ; X√≥a bit c·ªßa ch√¢n RD_PIN xu·ªëng m·ª©c th·∫•p ƒë·ªÉ b·∫Øt ƒ
                             ë·∫ßu qu√° tr√¨nh ƒë·ªçc d·ªØ li·ªáu t·ª´ ADC.
001B 1168             36         ACALL delay            ; G·ªçi ch∆∞∆°ng tr√¨nh con delay ƒë·ªÉ t·∫°o kho·∫£ng th·ªùi gi
                             an c·∫ßn thi·∫øt cho qu√° tr√¨nh ƒë·ªçc d·ªØ li·ªáu.
001D E590             37         MOV A, P1              ; Di chuy·ªÉn (Move) gi√° tr·ªã t·ª´ Port 1 (n∆°i d·ªØ li·ªáu AD
                             C ƒë∆∞·ª£c ƒë∆∞a ra) v√†o thanh ghi A (Accumulator).
001F F531             38         MOV TEMP_LM, A         ; Di chuy·ªÉn gi√° tr·ªã t·ª´ thanh ghi A v√†o v√πng nh·ªõ TEMP_
                             LM ƒë·ªÉ l∆∞u tr·ªØ gi√° tr·ªã ADC.
0021 D2B2             39         SETB RD_PIN            ; ƒê·∫∑t bit c·ªßa ch√¢n RD_PIN l√™n m·ª©c cao, k·∫øt th√∫c qu√°
                              tr√¨nh ƒë·ªçc d·ªØ li·ªáu t·ª´ ADC.
A51 MACRO ASSEMBLER  MAIN                                                                 05/03/2025 17:10:16 PAGE     2

0023 22               40         RET                    ; Tr·ªü v·ªÅ (Return) t·ª´ ch∆∞∆°ng tr√¨nh con.
                      41     
                      42     ;-------------------------------------------------
                      43     ; Chuy·ªÉn ƒë·ªïi gi√° tr·ªã ADC sang nhi·ªát ƒë·ªô
                      44     ; (gi·∫£ s·ª≠ 255 = 127.5¬∞C, x·∫•p x·ªâ nh√¢n 2)
                      45     ;-------------------------------------------------
0024                  46     adc_to_temp:
0024 E531             47         MOV A, TEMP_LM         ; Di chuy·ªÉn gi√° tr·ªã ADC t·ª´ TEMP_LM v√†o thanh ghi A.
0026 23               48         RL A                   ; D·ªãch tr√°i thanh ghi A m·ªôt bit (Rotate Left), t∆∞∆°ng ƒë∆∞
                             ∆°ng v·ªõi nh√¢n gi√° tr·ªã v·ªõi 2.
0027 F531             49         MOV TEMP_LM, A         ; Di chuy·ªÉn gi√° tr·ªã ƒë√£ nh√¢n ƒë√¥i t·ª´ thanh ghi A tr·ªü
                              l·∫°i v√πng nh·ªõ TEMP_LM.
0029 22               50         RET                    ; Tr·ªü v·ªÅ t·ª´ ch∆∞∆°ng tr√¨nh con.
                      51     
                      52     ;-------------------------------------------------
                      53     ; T√°ch nhi·ªát ƒë·ªô th√†nh 3 ch·ªØ s·ªë: R1 (trƒÉm), R2 (ch·ª•c), R3 (ƒë∆°n v·ªã)
                      54     ;-------------------------------------------------
002A                  55     extract_digits:
002A E531             56         MOV A, TEMP_LM         ; Di chuy·ªÉn gi√° tr·ªã nhi·ªát ƒë·ªô (ƒë√£ nh√¢n ƒë√¥i) t·ª´ T
                             EMP_LM v√†o thanh ghi A.
002C 75F064           57         MOV B, #100            ; Di chuy·ªÉn gi√° tr·ªã 100 v√†o thanh ghi B ƒë·ªÉ th·ª±c hi·ªá
                             n ph√©p chia.
002F 84               58         DIV AB                 ; Chia (Divide) gi√° tr·ªã trong A cho gi√° tr·ªã trong B. K·∫øt
                              qu·∫£: A ch·ª©a th∆∞∆°ng (h√†ng trƒÉm), B ch·ª©a s·ªë d∆∞.
0030 F9               59         MOV R1, A              ; Di chuy·ªÉn th∆∞∆°ng (h√†ng trƒÉm) t·ª´ thanh ghi A v√†o thanh
                              ghi R1.
0031 E5F0             60         MOV A, B               ; Di chuy·ªÉn s·ªë d∆∞ (ph·∫ßn c√≤n l·∫°i sau khi chia cho 100) 
                             t·ª´ thanh ghi B v√†o thanh ghi A.
0033 75F00A           61         MOV B, #10              ; Di chuy·ªÉn gi√° tr·ªã 10 v√†o thanh ghi B ƒë·ªÉ ti·∫øp t·ª•c
                              ph√©p chia.
0036 84               62         DIV AB                 ; Chia gi√° tr·ªã trong A (s·ªë d∆∞ tr∆∞·ªõc ƒë√≥) cho 10. K·∫øt
                              qu·∫£: A ch·ª©a th∆∞∆°ng (h√†ng ch·ª•c), B ch·ª©a s·ªë d∆∞ (h√†ng ƒë∆°n v·ªã).
0037 FA               63         MOV R2, A              ; Di chuy·ªÉn th∆∞∆°ng (h√†ng ch·ª•c) t·ª´ thanh ghi A v√†o than
                             h ghi R2.
0038 ABF0             64         MOV R3, B              ; Di chuy·ªÉn s·ªë d∆∞ (h√†ng ƒë∆°n v·ªã) t·ª´ thanh ghi B v√†o 
                             thanh ghi R3.
003A 22               65         RET                    ; Tr·ªü v·ªÅ t·ª´ ch∆∞∆°ng tr√¨nh con.
                      66     
                      67     ;-------------------------------------------------
                      68     ; Hi·ªÉn th·ªã 3 ch·ªØ s·ªë nhi·ªát ƒë·ªô tr√™n 4 LED 7 ƒëo·∫°n
                      69     ;-------------------------------------------------
003B                  70     display_numbers:
                      71         ; LED 1 - h√†ng trƒÉm
003B 7580FE           72         MOV P0, #0FEH          ; Ch·ªçn LED th·ª© nh·∫•t (P0.0 = 0, c√°c ch√¢n c√≤n l·∫°i = 1, 
                             active low).
003E 901000           73         MOV DPTR, #SEGMENT_CODE ; ƒê·∫∑t con tr·ªè d·ªØ li·ªáu (Data Pointer) tr·ªè ƒë·∫øn ƒë·ª
                             ãa ch·ªâ c·ªßa b·∫£ng m√£ LED 7 ƒëo·∫°n.
0041 E9               74         MOV A, R1              ; Di chuy·ªÉn gi√° tr·ªã h√†ng trƒÉm t·ª´ thanh ghi R1 v√†o than
                             h ghi A.
0042 93               75         MOVC A, @A+DPTR        ; Di chuy·ªÉn m√£ 7 ƒëo·∫°n t∆∞∆°ng ·ª©ng v·ªõi gi√° tr·ªã trong
                              A t·ª´ b·ªô nh·ªõ ch∆∞∆°ng tr√¨nh v√†o thanh ghi A.
0043 F5A0             76         MOV P2, A              ; Xu·∫•t m√£ 7 ƒëo·∫°n t·ª´ thanh ghi A ra Port 2 ƒë·ªÉ hi·ªÉn t
                             h·ªã l√™n LED.
0045 1171             77         ACALL DELAY_2MS        ; G·ªçi ch∆∞∆°ng tr√¨nh con delay ƒë·ªÉ LED hi·ªÉn th·ªã trong m
                             ·ªôt kho·∫£ng th·ªùi gian.
                      78     
                      79         ; LED 2 - h√†ng ch·ª•c
0047 7580FD           80         MOV P0, #0FDH          ; Ch·ªçn LED th·ª© hai (P0.1 = 0, c√°c ch√¢n c√≤n l·∫°i = 1).
004A 901000           81         MOV DPTR, #SEGMENT_CODE ; ƒê·∫∑t l·∫°i con tr·ªè d·ªØ li·ªáu tr·ªè ƒë·∫øn b·∫£ng m√£ LE
                             D.
004D EA               82         MOV A, R2              ; Di chuy·ªÉn gi√° tr·ªã h√†ng ch·ª•c t·ª´ thanh ghi R2 v√†o tha
                             nh ghi A.
004E 93               83         MOVC A, @A+DPTR        ; L·∫•y m√£ 7 ƒëo·∫°n cho h√†ng ch·ª•c.
004F F5A0             84         MOV P2, A              ; Xu·∫•t m√£ 7 ƒëo·∫°n ra Port 2.
0051 1171             85         ACALL DELAY_2MS        ; G·ªçi delay.
                      86     
A51 MACRO ASSEMBLER  MAIN                                                                 05/03/2025 17:10:16 PAGE     3

                      87         ; LED 3 - h√†ng ƒë∆°n v·ªã
0053 7580FB           88         MOV P0, #0FBH          ; Ch·ªçn LED th·ª© ba (P0.2 = 0, c√°c ch√¢n c√≤n l·∫°i = 1).
0056 901000           89         MOV DPTR, #SEGMENT_CODE ; ƒê·∫∑t l·∫°i con tr·ªè d·ªØ li·ªáu.
0059 EB               90         MOV A, R3              ; Di chuy·ªÉn gi√° tr·ªã h√†ng ƒë∆°n v·ªã t·ª´ thanh ghi R3 v√†o
                              thanh ghi A.
005A 93               91         MOVC A, @A+DPTR        ; L·∫•y m√£ 7 ƒëo·∫°n cho h√†ng ƒë∆°n v·ªã.
005B F5A0             92         MOV P2, A              ; Xu·∫•t m√£ 7 ƒëo·∫°n ra Port 2.
005D 1171             93         ACALL DELAY_2MS        ; G·ªçi delay.
                      94     
                      95         ; LED 4 - kh√¥ng d√πng (ho·∫∑c c√≥ th·ªÉ hi·ªán 'C')
005F 7580F7           96         MOV P0, #0F7H          ; Ch·ªçn LED th·ª© t∆∞ (P0.3 = 0, c√°c ch√¢n c√≤n l·∫°i = 1).
0062 75A0FF           97         MOV P2, #0FFH          ; T·∫Øt t·∫•t c·∫£ c√°c ƒëo·∫°n c·ªßa LED th·ª© t∆∞ (hi·ªÉn th·ª
                             ã tr·ªëng).
0065 1171             98         ACALL DELAY_2MS        ; G·ªçi delay.
                      99     
0067 22              100         RET                    ; Tr·ªü v·ªÅ t·ª´ ch∆∞∆°ng tr√¨nh con.
                     101     
                     102     ;-------------------------------------------------
                     103     ; Delay ng·∫Øn cho ADC
                     104     ;-------------------------------------------------
0068                 105     delay:
0068 7E64            106         MOV R6, #100           ; Thi·∫øt l·∫≠p gi√° tr·ªã ƒë·∫øm cho v√≤ng l·∫∑p delay ngo√†i.
006A 7F1F            107     D1: MOV R7, #1FH            ; Thi·∫øt l·∫≠p gi√° tr·ªã ƒë·∫øm cho v√≤ng l·∫∑p delay trong.
006C DFFE            108     D2: DJNZ R7, D2            ; Gi·∫£m gi√° tr·ªã R7 v√† nh·∫£y v·ªÅ D2 n·∫øu R7 kh√°c 0 (v√≤n
                             g l·∫∑p trong).
006E DEFA            109         DJNZ R6, D1            ; Gi·∫£m gi√° tr·ªã R6 v√† nh·∫£y v·ªÅ D1 n·∫øu R6 kh√°c 0 (v√≤n
                             g l·∫∑p ngo√†i).
0070 22              110         RET                    ; Tr·ªü v·ªÅ t·ª´ ch∆∞∆°ng tr√¨nh con delay.
                     111     
                     112     ;-------------------------------------------------
                     113     ; Delay ƒë·ªÉ hi·ªÉn th·ªã LED (kho·∫£ng ~2ms)
                     114     ;-------------------------------------------------
0071                 115     DELAY_2MS:
0071 7EFA            116         MOV R6, #250           ; Thi·∫øt l·∫≠p gi√° tr·ªã ƒë·∫øm cho v√≤ng l·∫∑p delay.
0073                 117     DELAY_LOOP:
0073 DEFE            118         DJNZ R6, DELAY_LOOP    ; Gi·∫£m gi√° tr·ªã R6 v√† nh·∫£y v·ªÅ DELAY_LOOP n·∫øu R6 kh√°c
                              0.
0075 22              119         RET                    ; Tr·ªü v·ªÅ t·ª´ ch∆∞∆°ng tr√¨nh con delay.
                     120     
                     121     ;-------------------------------------------------
                     122     ; B·∫£ng m√£ LED 7 ƒëo·∫°n (Cathode chung)
                     123     ; SEGMENT_CODE[0-9] = m√£ t·ª´ 0 ƒë·∫øn 9
                     124     ;-------------------------------------------------
1000                 125     ORG 1000H
1000                 126     SEGMENT_CODE:
1000 3F              127         DB 3FH ; 0             ; M√£ 7 ƒëo·∫°n ƒë·ªÉ hi·ªÉn th·ªã s·ªë 0.
1001 06              128         DB 06H ; 1             ; M√£ 7 ƒëo·∫°n ƒë·ªÉ hi·ªÉn th·ªã s·ªë 1.
1002 5B              129         DB 5BH ; 2             ; M√£ 7 ƒëo·∫°n ƒë·ªÉ hi·ªÉn th·ªã s·ªë 2.
1003 4F              130         DB 4FH ; 3             ; M√£ 7 ƒëo·∫°n ƒë·ªÉ hi·ªÉn th·ªã s·ªë 3.
1004 66              131         DB 66H ; 4             ; M√£ 7 ƒëo·∫°n ƒë·ªÉ hi·ªÉn th·ªã s·ªë 4.
1005 6D              132         DB 6DH ; 5             ; M√£ 7 ƒëo·∫°n ƒë·ªÉ hi·ªÉn th·ªã s·ªë 5.
1006 7D              133         DB 7DH ; 6             ; M√£ 7 ƒëo·∫°n ƒë·ªÉ hi·ªÉn th·ªã s·ªë 6.
1007 07              134         DB 07H ; 7             ; M√£ 7 ƒëo·∫°n ƒë·ªÉ hi·ªÉn th·ªã s·ªë 7.
1008 7F              135         DB 7FH ; 8             ; M√£ 7 ƒëo·∫°n ƒë·ªÉ hi·ªÉn th·ªã s·ªë 8.
1009 6F              136         DB 6FH ; 9             ; M√£ 7 ƒëo·∫°n ƒë·ªÉ hi·ªÉn th·ªã s·ªë 9.
                     137     
                     138     ;-------------------------------------------------
                     139     END
A51 MACRO ASSEMBLER  MAIN                                                                 05/03/2025 17:10:16 PAGE     4

SYMBOL TABLE LISTING
------ ----- -------


N A M E             T Y P E  V A L U E   ATTRIBUTES

ADC_TO_TEMP. . . .  C ADDR   0024H   A   
B. . . . . . . . .  D ADDR   00F0H   A   
D1 . . . . . . . .  C ADDR   006AH   A   
D2 . . . . . . . .  C ADDR   006CH   A   
DELAY. . . . . . .  C ADDR   0068H   A   
DELAY_2MS. . . . .  C ADDR   0071H   A   
DELAY_LOOP . . . .  C ADDR   0073H   A   
DISPLAY_NUMBERS. .  C ADDR   003BH   A   
EXTRACT_DIGITS . .  C ADDR   002AH   A   
INTR . . . . . . .  B ADDR   00B0H.4 A   
MAIN_LOOP. . . . .  C ADDR   0006H   A   
P0 . . . . . . . .  D ADDR   0080H   A   
P1 . . . . . . . .  D ADDR   0090H   A   
P2 . . . . . . . .  D ADDR   00A0H   A   
P3 . . . . . . . .  D ADDR   00B0H   A   
RD_PIN . . . . . .  B ADDR   00B0H.2 A   
READ_ADC . . . . .  C ADDR   0010H   A   
SEGMENT_CODE . . .  C ADDR   1000H   A   
START. . . . . . .  C ADDR   0000H   A   
TEMP_LM. . . . . .  N NUMB   0031H   A   
WAIT_INTR. . . . .  C ADDR   0016H   A   
WR_PIN . . . . . .  B ADDR   00B0H.3 A   


REGISTER BANK(S) USED: 0 


ASSEMBLY COMPLETE.  0 WARNING(S), 0 ERROR(S)
